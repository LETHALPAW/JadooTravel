
@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Admin/Layout.cshtml";
    var reservations = ViewBag.Reservations as List<ResultReservationDto>;
    var lastTours = ViewBag.LastTours as List<ResultDestinationDto>;
}



    <div class="body-wrapper-inner">
        <div class="container-fluid">

            
            <!--  Header Start -->
@await Component.InvokeAsync("_AdminHeaderViewComponentPartial")  

            <!--  Header End -->


            <!--  Row 1 -->
            <div class="row">
            <div class="col-lg-8 d-flex align-items-stretch">
                <div class="card w-100">
                    <div class="card-body">
                        <h5 class="card-title fw-semibold mb-3">Rotalara Göre Kapasite Grafiği</h5>

                        <!-- Grafik alanı -->
                        <div style="width:100%; height:400px;">
                            <canvas id="profitChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>


                <div class="col-lg-4">
                 
                    <div class="row">
                        <div class="col-lg-12 col-sm-6">
                        <!-- Reservation Traffic Card -->
                        <div class="card overflow-hidden">
                            <div class="card-body p-4">
                                <h5 class="card-title mb-10 fw-semibold">Rezervasyon Trafiği</h5>
                                <div class="row align-items-center">
                                    <div class="col-7">
                                        <h4 class="fw-semibold mb-3">@ViewBag.TotalReservations Toplam Rezervasyon</h4>

                                        <div class="d-flex align-items-center mb-2">
                                            <span class="me-1 rounded-circle bg-light-success round-20 d-flex align-items-center justify-content-center">
                                                <i class="ti ti-arrow-up-left text-success"></i>
                                            </span>
                                            <p class="text-dark me-1 fs-3 mb-0">+@ViewBag.GrowthRate%</p>
                                            <p class="fs-3 mb-0">geçen aya göre artış</p>
                                        </div>

                                        <p class="text-muted fs-3 mb-3">
                                            Bu ay <strong>@ViewBag.ThisMonthReservations</strong> yeni rezervasyon alındı.
                                        </p>

                                        <div class="d-flex align-items-center">
                                            <div class="me-3">
                                                <span class="round-8 bg-primary rounded-circle me-2 d-inline-block"></span>
                                                <span class="fs-2">Web Sitesi (@ViewBag.WebsiteRate%)</span>
                                            </div>
                                            <div class="me-3">
                                                <span class="round-8 bg-danger rounded-circle me-2 d-inline-block"></span>
                                                <span class="fs-2">Instagram (@ViewBag.InstagramRate%)</span>
                                            </div>
                                            <div>
                                                <span class="round-8 bg-success rounded-circle me-2 d-inline-block"></span>
                                                <span class="fs-2">WhatsApp (@ViewBag.WhatsappRate%)</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-5">
                                        <div class="d-flex justify-content-center">
                                            <div id="grade"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        </div>
                        <div class="col-lg-12 col-sm-6">
                            <!-- Monthly Earnings -->
                        <div class="card">
                            <div class="card-body">
                                <div class="row align-items-start">
                                    <div class="col-8">
                                        <h5 class="card-title mb-10 fw-semibold">Toplam Gelir</h5>
                                        <h4 class="fw-semibold mb-3">₺68,200</h4>
                                        <div class="d-flex align-items-center pb-1">
                                            <span class="me-2 rounded-circle bg-light-success round-20 d-flex align-items-center justify-content-center">
                                                <i class="ti ti-arrow-up-left text-success"></i>
                                            </span>
                                            <p class="text-dark me-1 fs-3 mb-0">+15%</p>
                                            <p class="fs-3 mb-0">geçen aya göre artış</p>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div class="d-flex justify-content-end">
                                            <div class="text-white bg-success rounded-circle p-6 d-flex align-items-center justify-content-center">
                                                <i class="ti ti-currency-lira fs-6"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Mini Grafik -->
                            <div id="earning"></div>
                        </div>

                       

                        </div>
                    </div>
                </div>
            </div>


        <div class="row">
            <div class="col-lg-12 d-flex align-items-stretch">
                <div class="card w-100">
                    <div class="card-body p-4">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <div class="d-flex align-items-center">
                                <i class="ti ti-calendar-event fs-4 bg-primary text-white rounded-circle p-2 me-2"></i>
                                <h5 class="fw-bold mb-0">Rezervasyon Bilgileri</h5>
                            </div>
                            <span class="badge bg-light-primary text-primary fs-3 px-3 py-2 rounded-pill">
                                Son @reservations?.Count() rezervasyon
                            </span>
                        </div>

                        <div class="table-responsive" data-simplebar>
                            <table class="table table-borderless align-middle text-nowrap">
                                <thead class="bg-light">
                                    <tr>
                                        <th scope="col">İsim Soyisim</th>
                                        <th scope="col">Email</th>
                                        <th scope="col">Telefon</th>
                                        <th scope="col">Rezervasyon Tarihi</th>
                                        <th scope="col">Mesaj</th>
                                    </tr>
                                </thead>

                                <tbody>
                                    @if (reservations != null && reservations.Any())
                                    {
                                        foreach (var item in reservations)
                                        {
                                            <tr>
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        <div class="d-flex align-items-center justify-content-center bg-light rounded-circle"
                                                             style="width:40px; height:40px;">
                                                            <iconify-icon icon="mdi:calendar-check" class="text-primary fs-5"></iconify-icon>
                                                        </div>
                                                        <div>
                                                            <h6 class="mb-1 fw-bolder">@item.FullName</h6>
                                                            <p class="fs-3 mb-0 text-muted">ID: @item.ReservationId</p>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td><p class="fs-3 mb-0">@item.Email</p></td>
                                                <td><p class="fs-3 mb-0">@item.PhoneNumber</p></td>
                                                <td><p class="fs-3 mb-0">@item.Created.ToString("dd MMM yyyy")</p></td>
                                                <td><p class="fs-3 mb-0">@item.ReservationMessage</p></td>
                                            </tr>
                                        }
                                    }
                                    else
                                    {
                                        <tr>
                                            <td colspan="5" class="text-center text-muted py-4">
                                                Henüz bir rezervasyon kaydı bulunmamaktadır.
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>

                    </div>
                </div>
            </div>
        </div>


            <div class="row">
            @foreach (var tour in lastTours)
            {
                <div class="col-sm-6 col-xl-3 mb-4">
                    <div class="card overflow-hidden shadow-sm">
                        <div class="position-relative">
                            <a href="javascript:void(0)">
                                <img src="@tour.ImageUrl"
                                     class="card-img-top rounded-0"
                                     alt="@tour.CityCountry">
                            </a>

                            <a href="javascript:void(0)"
                               class="bg-primary rounded-circle p-2 text-white d-inline-flex position-absolute bottom-0 end-0 mb-n3 me-3"
                               data-bs-toggle="tooltip" data-bs-placement="top" title="View Details">
                                <i class="ti ti-map fs-4"></i>
                            </a>
                        </div>

                        <div class="card-body pt-3 p-4">
                            <h6 class="fw-semibold fs-4">@tour.CityCountry</h6>

                           
                            <p class="mt-2 text-muted fs-3">
                                Kapasite: @tour.Capacity kişi
                            </p>
                        </div>
                    </div>
                </div>
            }
            </div>


            <div class="py-6 px-6 text-center">
                <p class="mb-0 fs-4">
                    Design and Developed by <a href="https://www.wrappixel.com/" target="_blank" class="pe-1 text-primary text-decoration-underline">wrappixel.com</a> Distributed by <a href="https://themewagon.com/">Merve Arpacıoğlu</a>
                </p>
            </div>
        </div>
    </div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const ctx = document.getElementById('profitChart').getContext('2d');

        // Controller'dan gelen veriler
        const labels = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(ViewBag.DestinationNames));
        const values = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(ViewBag.Capacities));

        // Her rota için farklı renk (renkli barlar)
        const colors = [
            'rgba(255, 99, 132, 0.7)',
            'rgba(54, 162, 235, 0.7)',
            'rgba(255, 206, 86, 0.7)',
            'rgba(75, 192, 192, 0.7)',
            'rgba(153, 102, 255, 0.7)',
            'rgba(255, 159, 64, 0.7)'
        ];
        const bgColors = labels.map((_, i) => colors[i % colors.length]);

        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Kapasite (Kişi)',
                    data: values,
                    backgroundColor: bgColors,
                    borderColor: bgColors.map(c => c.replace('0.7', '1')),
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    title: {
                        display: true,
                        text: 'Rotalara Göre Kapasite Dağılımı',
                        font: { size: 16 }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.label + ": " + context.parsed.y + " kişi";
                            }
                        }
                    }
                },
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });
    });
</script>
<script>
    var options = {
        chart: {
            type: 'area',
            height: 100,
            sparkline: { enabled: true }
        },
        series: [{
            name: 'Aylık Gelir',
            data: [28, 35, 30, 40, 45, 50, 60, 75, 70, 85, 90, 100]
        }],
        colors: ['#13DEB9'],
        stroke: { width: 2, curve: 'smooth' },
        fill: { opacity: 0.3 },
        tooltip: {
            theme: 'dark',
            y: {
                formatter: function(val) { return '₺' + val + ' Bin'; }
            }
        }
    };
    var chart = new ApexCharts(document.querySelector("#earning"), options);
    chart.render();
</script>
